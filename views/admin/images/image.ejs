<!DOCTYPE html>
<html lang="en" class="bg-neutral-950 text-gray-100 font-Figtree">
  <head>
    <meta charset="UTF-8" />
    <title><%= name %> - Image Details</title>
    <link rel="stylesheet" href="/assets/tailwind.css">
    <script src="https://unpkg.com/lucide@latest"></script>
  </head>
  <body class="min-h-screen flex">
    <%- include('../../components/sidebar', { name, user }) %>

    <main class="flex-1 p-8 overflow-auto">
      <div class="max-w-4xl mx-auto space-y-6">

        <!-- Header -->
        <div class="flex justify-between items-center bg-neutral-950 border border-neutral-900 p-6 rounded-2xl">
          <h1 class="text-3xl font-bold">ðŸ–¼ Image Details</h1>
          <div class="flex gap-2">
            <button
              onclick="deleteImage('<%= image.id %>')"
              class="flex items-center gap-2 bg-red-600 hover:bg-red-700 px-4 py-2 rounded-xl font-medium"
            >
              <i data-lucide="trash-2" class="w-4 h-4"></i> Delete
            </button>
            <a
              href="/admin/images/export/<%= image.id %>"
              target="_blank"
              class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-xl font-medium"
            >
              <i data-lucide="download" class="w-4 h-4"></i> Export
            </a>
          </div>
        </div>

        <!-- Image Details -->
        <div class="bg-neutral-950 border border-neutral-800 p-6 rounded-2xl space-y-4">
          <p><strong>Name:</strong> <%= image.name %></p>
          <p><strong>Docker Image:</strong> <%= image.dockerImage %></p>
          <p><strong>Description:</strong> <%= image.description || 'No description' %></p>
          <p><strong>Created At:</strong> <%= new Date(image.createdAt).toLocaleString() %></p>

          <div>
            <h2 class="font-semibold mb-2">Environment Variables</h2>
            <% if (image.envs && Object.keys(image.envs).length) { %>
              <ul class="list-disc list-inside text-gray-400">
                <% Object.entries(image.envs).forEach(([key, value]) => { %>
                  <li><strong><%= key %>:</strong> <%= value %></li>
                <% }) %>
              </ul>
            <% } else { %>
              <p class="text-gray-500">No environment variables set.</p>
            <% } %>
          </div>

          <div>
            <h2 class="font-semibold mb-2">Files</h2>
            <% if (image.files && image.files.length) { %>
              <ul class="list-disc list-inside text-gray-400">
                <% image.files.forEach(file => { %>
                  <li>
                    <a href="<%= file.url %>" target="_blank" class="text-indigo-400 hover:underline">
                      <%= file.filename %>
                    </a>
                  </li>
                <% }) %>
              </ul>
            <% } else { %>
              <p class="text-gray-500">No files uploaded.</p>
            <% } %>
          </div>
        </div>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      lucide.createIcons();

      async function deleteImage(id) {
        if (!confirm("Are you sure you want to delete this image?")) return;
        try {
          const res = await axios.post(`/admin/images/delete/${id}`);
          if (res.data.success) window.location.href = "/admin/images";
        } catch (err) {
          alert("Failed to delete image");
        }
      }
    </script>
  </body>
</html>
