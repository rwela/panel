<!DOCTYPE html>
<html lang="en" class="bg-neutral-950 text-gray-100 font-Figtree">
  <head>
    <meta charset="UTF-8" />
    <title><%= name %> - Servers</title>
    <link rel="stylesheet" href="/assets/tailwind.css">
    <script src="https://unpkg.com/lucide@latest"></script>
  </head>
  <body class="min-h-screen flex">
    <%- include('../components/sidebar', { name, user }) %>

    <main class="flex-1 p-8 overflow-auto">
      <div class="max-w-6xl mx-auto space-y-6">
        <div
          class="bg-neutral-950 border border-neutral-900 p-6 rounded-2xl flex justify-between items-center"
        >
         <div>
  <h1 class="text-3xl font-bold flex items-center gap-2">
    <i data-lucide="server" class="w-6 h-6"></i> Servers
  </h1>
  <p class="text-gray-400">Manage all user servers</p>
</div>

          <a
            href="/admin/servers/new"
            class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-xl font-medium"
          >
            + Create Server
          </a>
        </div>

     <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
  <% servers.forEach(server => { 
       const image = images.find(i => i.id === server.imageId); 
       const owner = users.find(u => u.id === server.userId); 
  %>
    <div class="bg-neutral-950 border border-neutral-800 p-6 rounded-2xl shadow-lg flex flex-col justify-between">
      
      <!-- Top: Name & Node -->
      <div class="flex justify-between items-center mb-4">
        <div class="font-semibold text-gray-100"><%= server.name %></div>
        <div class="text-gray-400 text-sm"><%= server.node ? server.node.name : 'Unknown' %></div>
      </div>

      <!-- Middle: Details -->
      <div class="grid grid-cols-2 gap-4 mb-4 text-gray-400 text-sm">
        <div>
          <span class="font-medium text-gray-300">Image:</span> <%= image ? image.name : 'Unknown' %>
        </div>
        <div>
          <span class="font-medium text-gray-300">Owner:</span> <%= owner ? owner.username : 'Unknown' %>
        </div>
        <div class="flex items-center gap-1">
          <span class="font-medium text-gray-300">CPU:</span> <i data-lucide="cpu" class="w-4 h-4"></i> <%= server.core %>
        </div>
        <div class="flex items-center gap-1">
          <span class="font-medium text-gray-300">RAM:</span> <i data-lucide="memory-stick" class="w-4 h-4"></i> <%= server.ram %> MB
        </div>
        <div>
          <span class="font-medium text-gray-300">Port:</span> <%= server.port %>
        </div>
      </div>

      <!-- Bottom: Actions -->
      <div class="flex flex-wrap justify-end gap-2">
        <!-- Suspend/Unsuspend -->
        <button onclick="toggleSuspend('<%= server.id %>', '<%= server.suspended %>')"
          class="px-3 py-1.5 rounded-xl text-sm flex items-center gap-2 <%= server.suspended ? 'bg-yellow-500 hover:bg-yellow-600' : 'bg-green-600 hover:bg-green-700' %>">
          <i data-lucide="<%= server.suspended ? 'play' : 'pause' %>" class="w-4 h-4"></i>
          <%= server.suspended ? 'Unsuspend' : 'Suspend' %>
        </button>

        <!-- Edit -->
        <a href="/admin/edit/<%= server.id %>"
          class="bg-blue-600 hover:bg-blue-700 px-3 py-1.5 rounded-xl text-sm flex items-center gap-2">
          <i data-lucide="edit-2" class="w-4 h-4"></i> Edit
        </a>

        <!-- Delete -->
        <button onclick="deleteServer('<%= server.id %>')"
          class="bg-red-600 hover:bg-red-700 px-3 py-1.5 rounded-xl text-sm flex items-center gap-2">
          <i data-lucide="trash-2" class="w-4 h-4"></i> Delete
        </button>
      </div>

    </div>
  <% }) %>
</div>

      </div>
    </main>

    <script>
      lucide.createIcons();

      async function deleteServer(id) {
        if (!confirm("Are you sure you want to delete this server?")) return;
        const res = await fetch(`/admin/servers/delete/${id}`, {
          method: "DELETE",
        });
        if (res.ok) location.reload();
        else alert("Failed to delete server");
      }
      async function toggleSuspend(id, currentlySuspended) {
        const action = currentlySuspended ? "unsuspend" : "suspend";
        const res = await fetch(`/admin/servers/${action}/${id}`, {
          method: "POST",
        });
        if (res.ok) location.reload();
        else alert(`Failed to ${action} server`);
      }
    </script>
  </body>
</html>
