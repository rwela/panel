<!DOCTYPE html>
<html lang="en" class="bg-neutral-950 text-gray-100 font-Figtree">
<head>
  <meta charset="UTF-8" />
  <title><%= name %> - Users</title>
  <link rel="stylesheet" href="/assets/tailwind.css">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="min-h-screen flex">
  <%- include('../../components/sidebar', { name, user }) %>

  <main class="flex-1 p-8 overflow-auto">
    <div class="max-w-6xl mx-auto space-y-6">

      <!-- Header -->
      <div class="bg-neutral-950 border border-neutral-900 p-6 rounded-2xl flex justify-between items-center">
        <div>
          <h1 class="text-3xl font-bold flex items-center gap-2">
            <i data-lucide="users" class="w-6 h-6"></i> Users
          </h1>
          <p class="text-gray-400">Manage all users</p>
        </div>

        
  <!-- Open Modal Button -->
  <button
    onclick="openCreateModal()"
    class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-xl font-medium transition"
  >
    + Create User
  </button>
      </div>

      <div class="bg-neutral-950 border border-neutral-900 rounded-lg overflow-hidden">
  <table class="w-full table-auto text-left border-collapse">
    <thead class="text-neutral-400 uppercase text-xs border-b border-neutral-800">
      <tr>
        <th class="px-4 py-2">Username</th>
        <th class="px-4 py-2">Email</th>
        <th class="px-4 py-2">Role</th>
        <th class="px-4 py-2">Servers</th>
        <th class="px-4 py-2 text-right">Actions</th>
      </tr>
    </thead>

    <tbody>
      <% if (users && users.length > 0) { %>
        <% users.forEach(u => { %>
          <tr class="border-b border-neutral-800 hover:bg-neutral-900/50 transition-colors">
            
            <!-- Username -->
            <td class="px-4 py-3 font-semibold text-gray-100 flex items-center gap-2">
              <i data-lucide="<%= u.admin ? 'shield' : 'user' %>" class="w-4 h-4 <%= u.admin ? 'text-indigo-400' : 'text-gray-400' %>"></i>
              <%= u.username %>
            </td>

            <!-- Email -->
            <td class="px-4 py-3 text-gray-400">
              <%= u.email %>
            </td>

            <!-- Role -->
            <td class="px-4 py-3 text-gray-400">
              <%= u.admin ? 'Admin' : 'User' %>
            </td>

            <!-- Servers -->
            <td class="px-4 py-3 text-gray-400">
              <%= u.servers?.length || 0 %>
            </td>

            <!-- Actions -->
            <td class="px-4 py-3 text-right flex justify-end gap-2">
              <a href="/admin/user/<%= u.id %>" class="px-3 py-1 text-xs font-semibold rounded-lg bg-blue-600 hover:bg-blue-700">
                View
              </a>
              <a href="/admin/user/<%= u.id %>/edit" class="px-3 py-1 text-xs font-semibold rounded-lg bg-neutral-800 hover:bg-neutral-700">
                Edit
              </a>
            </td>

          </tr>
        <% }) %>
      <% } else { %>
        <tr>
          <td colspan="5" class="px-4 py-6 text-neutral-500 italic text-center">
            No users found.
          </td>
        </tr>
      <% } %>
    </tbody>
  </table>
</div>
<div id="createModal" class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50">
  <div class="bg-neutral-950 border border-neutral-900 p-8 w-full max-w-lg transform scale-95 opacity-0 rounded-2xl shadow-2xl">
    <h2 class="text-2xl font-semibold mb-6">Create User</h2>
    <div class="space-y-4">
      <input id="u-username" placeholder="Username" class="w-full px-4 py-2.5 text-md focus:outline-none focus:ring-2 focus:ring-neutral-900 bg-neutral-900/60 text-neutral-100 border-neutral-800/60 placeholder-neutral-500" />
      <input id="u-email" placeholder="Email" class="w-full px-4 py-2.5 text-md focus:outline-none focus:ring-2 focus:ring-neutral-900 bg-neutral-900/60 text-neutral-100 border-neutral-800/60 placeholder-neutral-500" />
      <input id="u-password" placeholder="Password" type="password" class="w-full px-4 py-2.5 text-md focus:outline-none focus:ring-2 focus:ring-neutral-900 bg-neutral-900/60 text-neutral-100 border-neutral-800/60 placeholder-neutral-500" />
      <label class="flex items-center gap-2">
        <input type="checkbox" id="u-admin" class="w-4 h-4" />
        Admin
      </label>
    </div>
    <div class="flex justify-end gap-3 mt-8">
      <button onclick="closeCreateModal()" class="px-5 py-2 bg-red-600 text-white transition rounded-md hover:bg-red-700">Cancel</button>
      <button onclick="createUser()" class="px-5 py-2 bg-gray-100 text-neutral-950 transition rounded-md hover:bg-gray-300">Create</button>
    </div>
  </div>
</div>
    </div>
  </main>

 <script>
  lucide.createIcons();
  const modal = document.getElementById("createModal");
  const modalContent = modal.querySelector("div");

  function openCreateModal() {
    modal.classList.remove("hidden");
    modal.classList.add("flex");
    setTimeout(() => {
      modalContent.classList.add("modal-enter-active");
      modalContent.classList.remove("scale-95", "opacity-0");
    }, 10);
  }

  function closeCreateModal() {
    modalContent.classList.remove("modal-enter-active");
    modalContent.classList.add("modal-leave-active");
    setTimeout(() => {
      modal.classList.add("hidden");
      modal.classList.remove("flex");
      modalContent.classList.remove("modal-leave-active");
      modalContent.classList.add("scale-95", "opacity-0");
    }, 250);
  }

  async function createUser() {
    const username = document.getElementById("u-username").value;
    const email = document.getElementById("u-email").value;
    const password = document.getElementById("u-password").value;
    const admin = document.getElementById("u-admin").checked;

    if (!username || !email || !password) return alert("All fields are required");

    const res = await fetch("/admin/users/new", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, email, password, admin })
    });

    if (res.ok) location.reload();
    else alert("Failed to create user");
  }
</script>

</body>
</html>
