<!DOCTYPE html>
<html lang="en" class="bg-neutral-950 text-gray-100 font-Figtree">
  <head>
    <meta charset="UTF-8" />
    <title><%= name %> - Nodes</title>
    <link rel="stylesheet" href="/assets/tailwind.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      .input {
        width: 100%;
        background: #0a0a0a;
        border: 1px solid #262626;
        padding: 0.5rem 0.75rem;
        border-radius: 0.75rem;
        transition: border 0.2s, background 0.2s;
      }

      .input:focus {
        outline: none;
        border-color: #6366f1;
        background: #111111;
      }

      @keyframes heartbeat {
        0% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.3); opacity: 0.6; }
        100% { transform: scale(1); opacity: 1; }
      }

      .heartbeat {
        animation: heartbeat 2s infinite;
      }

      /* Modal animations */
      .modal-enter {
        opacity: 0;
        transform: scale(0.9);
      }
      .modal-enter-active {
        opacity: 1;
        transform: scale(1);
        transition: opacity 0.25s ease, transform 0.25s ease;
      }
      .modal-leave {
        opacity: 1;
        transform: scale(1);
      }
      .modal-leave-active {
        opacity: 0;
        transform: scale(0.9);
        transition: opacity 0.25s ease, transform 0.25s ease;
      }
    </style>
  </head>
  <body class="min-h-screen flex">
    <%- include('../components/sidebar', { name, user }) %>

    <main class="flex-1 p-8 overflow-auto">
      <div class="max-w-6xl mx-auto space-y-6">
        <div class="bg-neutral-950 border border-neutral-900 p-6 rounded-2xl flex justify-between items-center">
          <div>
  <h1 class="text-3xl font-bold flex items-center gap-2">
    <i data-lucide="cpu" class="w-6 h-6"></i> Nodes
  </h1>
  <p class="text-gray-400">Manage all connected nodes</p>
</div>

          <button onclick="openCreateModal()" class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-xl font-medium transition">
            + Create Node
          </button>
        </div>
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
  <% nodes.forEach(node => { %>
    <div class="bg-neutral-950 border border-neutral-800 p-6 rounded-2xl shadow-lg flex flex-col justify-between">
      
      <!-- Top: Status and Name -->
      <div class="flex justify-between items-center mb-4">
        <div class="flex items-center gap-2">
          <% if (node.status === "online") { %>
            <i data-lucide="heart-pulse" class="w-5 h-5 text-green-400 heartbeat"></i>
          <% } else if (node.status === "dockernotrunning") { %>
            <i data-lucide="alert-triangle" class="w-5 h-5 text-yellow-400"></i>
          <% } else { %>
            <i data-lucide="x-circle" class="w-5 h-5 text-red-400"></i>
          <% } %>
          <span class="font-semibold text-gray-100"><%= node.name %></span>
        </div>
        <span class="text-gray-400 text-sm"><%= node.ip %>:<%= node.port %></span>
      </div>

      <!-- Middle: Specs with Labels -->
      <div class="grid grid-cols-2 gap-4 mb-4 text-gray-400 text-sm">
        <div>
          <span class="font-medium text-gray-300">CPU:</span> <%= node.core %> Cores
        </div>
        <div>
          <span class="font-medium text-gray-300">RAM:</span> <%= node.ram %> MB
        </div>
      </div>

      <!-- Bottom: Actions -->
      <div class="text-right">
        <a href="/admin/node/<%= node.id %>" class="inline-flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 px-3 py-2 rounded-xl text-sm transition">
          <i data-lucide="settings" class="w-4 h-4"></i> Manage
        </a>
      </div>

    </div>
  <% }) %>
</div>


      </div>
    </main>
<!-- Create Node Modal -->
<div id="createModal" class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50">
  <div class="bg-neutral-950 border border-neutral-900 p-8 w-full max-w-lg transform scale-95 opacity-0 rounded-2xl shadow-2xl">
    <h2 class="text-2xl font-semibold mb-6">Create Node</h2>
    <div class="space-y-4">
      <input id="n-name" placeholder="Node Name" class="input w-full" />
      <input id="n-ip" placeholder="IP (or localhost)" class="input w-full" />
      <input id="n-port" placeholder="Port" class="input w-full" />
      <input id="n-ram" placeholder="RAM (MB)" class="input w-full" />
      <input id="n-core" placeholder="CPU Cores" class="input w-full" />
    </div>
    <div class="flex justify-end gap-3 mt-8">
      <button onclick="closeCreateModal()" class="px-5 py-2 bg-red-600 text-white transition rounded-lg hover:bg-red-700">Cancel</button>
      <button onclick="createNode()" class="px-5 py-2 bg-white text-neutral-950 transition rounded-lg hover:bg-gray-200">Create</button>
    </div>
  </div>
</div>


    <script>
      lucide.createIcons();

      const modal = document.getElementById("createModal");
      const modalContent = modal.querySelector("div");

      function openCreateModal() {
        modal.classList.remove("hidden");
        modal.classList.add("flex");
        setTimeout(() => {
          modalContent.classList.add("modal-enter-active");
          modalContent.classList.remove("scale-95", "opacity-0");
        }, 10);
      }

      function closeCreateModal() {
        modalContent.classList.remove("modal-enter-active");
        modalContent.classList.add("modal-leave-active");
        setTimeout(() => {
          modal.classList.add("hidden");
          modal.classList.remove("flex");
          modalContent.classList.remove("modal-leave-active");
          modalContent.classList.add("scale-95", "opacity-0");
        }, 250);
      }

      async function createNode() {
        const body = {
          name: document.getElementById("n-name").value,
          ip: document.getElementById("n-ip").value,
          port: document.getElementById("n-port").value,
          ram: document.getElementById("n-ram").value,
          core: document.getElementById("n-core").value,
        };

        const res = await fetch("/admin/node/create", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body),
        });

        if (res.ok) location.reload();
        else alert("Failed to create node");
      }
    </script>
  </body>
</html>
